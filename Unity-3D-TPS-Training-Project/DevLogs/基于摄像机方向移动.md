# 修改 PlayerMovement 脚本

## 原本的移动代码：
```
Vector3 move = transform.right * h + transform.forward * v;
//transform.right--->角色的右方向
//根据输入，算出移动方向的向量
controller.Move(move*moveSpeed*Time.deltaTime);
//move是方向、movespeed是速度

```



## 现在要改成：“基于摄像机方向移动”


“第三人称移动系统的核心公式”。

代码功能：**把“键盘输入方向”转换成“基于摄像机朝向的移动方向”**

### 变量区域添加：

```
public Transform cameraTransform

```
作用：

保存了摄像机的Transform。

从摄像机那里拿到
 
它朝哪儿看 → forward

它右边是哪 → right

### 在update里面添加修改：

```
float x = Input.GetAxis("Horizontal");
float z = Input.GetAxis("Vertical");

// 摄像机方向
Vector3 forward = cameraTransform.forward;
Vector3 right = cameraTransform.right;

// 不要让角色飞起来
forward.y = 0f;
right.y = 0f;

forward.Normalize();
right.Normalize();

// 最终移动方向
Vector3 move = forward * z + right * x;

controller.Move(move * speed * Time.deltaTime);

```

一句一句解释：
①
```
float x = Input.GetAxis("Horizontal");
float z = Input.GetAxis("Vertical");

```

| 键 | 值      |
| - | ------ |
| W | z = +1 |
| S | z = -1 |
| D | x = +1 |
| A | x = -1 |

这两个值，说明的是玩家想要往前后、左右移动的意图。

②
```
Vector3 forward = cameraTransform.forward;
Vector3 right = cameraTransform.right;
```

| 向量      | 意义       |
| ------- | -------- |
| forward | 摄像机朝向的方向 |
| right   | 摄像机右边的方向 |


玩家看到哪一边是‘前’，游戏就把那边当成前。


③
```
forward.y = 0f;
right.y = 0f;

```

必须要清除Y

角色在移动的时候，会“飞起来或钻地”，因此必须将y固定为0；


④
```
forward.Normalize();
right.Normalize();

```
摄像机斜着看的时候，forward会变短。

从而导致移动会忽快忽慢

所以Normalize之后，就是只保留了方向，不会影响速度。


⑤核心公式

```
Vector3 move = forward * z + right * x;

```

最终移动方向 = 摄像机前方向 * 前后输入

             + 摄像机右方向 * 左右输入

⑥最终移动

```
controller.Move(move * speed * Time.deltaTime);

```

最终移动

| 部分             | 作用         |
| -------------- | ---------- |
| move           | 方向         |
| speed          | 速度         |
| Time.deltaTime | 保证不同帧率速度一致 |


