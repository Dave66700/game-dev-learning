## 现在的位置：

功能可以实现，结构出问题

- Update里switch和if太多
- 可能cooldown、距离受击互相抢控制权
- 增加一个功能，改很多
- 状态之间没有“所有权”

## FSM在TPS里面真正解决什么？

①状态打断

追击中->被击中->HitForce

如果不用FSM，则要在各个方面（Chase / Attack / Patrol）写

if/switch

而FSM：
stateMachine.ChangeState(hitState);

②行为独占

FSM的核心不是切换

而是

排他控制权

③可扩展

可能会有其他功能需要被添加


## 计划是什么

接下来要怎么办？

先明确EnemyFSM状态集合

| 状态         | 进入条件                  | 离开条件                                                     | 备注             |
| ---------- | --------------------- | -------------------------------------------------------- | -------------- |
| **Idle**   | 初始状态，或者玩家离开检测范围       | 玩家进入检测范围 → **Chase**                                     | 默认状态，不做任何动作    |
| **Chase**  | 玩家进入检测范围              | 玩家进入攻击范围 → **Attack**<br>玩家离开检测范围 → **Idle**             | 追踪玩家，移动行为      |
| **Attack** | 玩家进入攻击范围              | 玩家超出攻击范围 → **Chase**<br>敌人死亡 → **Dead**                  | 攻击行为，内部有攻击冷却   |
| **Hit**    | 被攻击 → 调用 TakeDamage() | 短暂受击完成 → 返回之前状态（Chase/Idle/Attack）<br>血量 <= 0 → **Dead** | 强制打断当前状态       |
| **Dead**   | 血量 <= 0               | 永远                                                       | 死亡状态不可逆，锁死 FSM |
