# 摄像机防穿墙

## 现在的问题：

现在如果角色靠墙，摄像机就会：

穿进墙里、画面被挡住、看不到角色

## 解决方法：

检测摄像机和角色之间有没有障碍物

如果有障碍物：

摄像机就自动向前挪、贴到墙前面

仿佛摄像机后面有一根隐形弹簧

## 对于这个检测：我们要用新的知识实现

**Physics.Raycast（射线检测）**

原理：

```
CameraTarget ●──────────────● 摄像机理想位置
             ↑ 发射射线
```

这里，我们要检测到是：角色和摄像机之间有没有墙挡着

所以，射线必须是CameraTarget（角色头部）->摄像机“理想位置”。

摄像机思路：

- 先算出摄像机 理想位置

- 从 CameraTarget 向那个点发射射线

- 如果没撞到东西 → 正常去那个位置

- 如果撞到墙 → 摄像机位置 = 撞击点往前一点

 ## 代码部分：

 ``` csharp
public float collisionOffset = 0.2f;

```
摄像机不要贴墙贴太死，留一些空隙。

``` csharp
RaycastHit hit;

if (Physics.Linecast(target.position, desiredPosition, out hit))
{
    desiredPosition = hit.point + hit.normal * collisionOffset;
}
```
逐行拆解认识


**1. RaycastHit hit;**

声明一个RaycastHit结构体
用于存储射线检测的碰撞信息

**2. Physics.Linecast(target.position, desiredPosition, out hit)**

返回值：bool，true=检测到碰撞，false=无碰撞
Linecast：从A点到B点发射一条"检测线"

target.position：起点（通常是玩家位置）

desiredPosition：终点（期望的摄像机位置）

out hit：输出参数，存储碰撞信息，就是把碰撞的信息放到我新声明的结构体

**3. desiredPosition = hit.point + hit.normal * collisionOffset;**

如果发生碰撞，调整摄像机位置：
hit.point：碰撞点的坐标

hit.normal：碰撞表面的法线（垂直方向）

collisionOffset：偏移距离

新位置 = 碰撞点 + 沿着法线方向偏移一点距离
